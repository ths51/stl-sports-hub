allData = {
    "colors": [

        {
            "team": "",
            "color1": "#000000",
            "color2": "#555555"
        },

        {
            "team": "ANA",
            "color1": "#111111",
            "color2": "#F95602"
        },
        
        {
            "team": "ARI",
            "color1": "#111111",
            "color2": "#952C33"
        },
        {
            "team": "BOS",
            "color1": "#111111",
            "color2": "#FCB514"
        },
        
        {
            "team": "BUF",
            "color1": "#003087",
            "color2": "FFB81C"
        },
        {
            "team": "CGY",
            "color1": "#D2001C",
            "color2": "#FAAF19"
        },
        
        {
            "team": "CAR",
            "color1": "#D2001C",
            "color2": "#111111"
        },
        {
            "team": "CHI",
            "color1": "#CF0A2C",
            "color2": "#000000"
        },
        
        {
            "team": "COL",
            "color1": "#6F263D",
            "color2": "#236192"
        },
        {
            "team": "CBJ",
            "color1": "#002654",
            "color2": "#CE1126"
        },
        
        {
            "team": "DAL",
            "color1": "#00833C",
            "color2": "#111111"
        },
        {
            "team": "DET",
            "color1": "#CE1126",
            "color2": "#FFFFFF"
        },
        
        {
            "team": "EDM",
            "color1": "#02225D",
            "color2": "#FC4C02"
        },
        {
            "team": "FLA",
            "color1": "#C8102E",
            "color2": "#041E42"
        },
        
        {
            "team": "LAK",
            "color1": "#000000",
            "color2": "#A2AAAD"
        },
        {
            "team": "MIN",
            "color1": "#024930",
            "color2": "AF1E24"
        },
        
        {
            "team": "MTL",
            "color1": "#AF1E2D",
            "color2": "#192168"
        },
        {
            "team": "NSH",
            "color1": "#FFB81C",
            "color2": "#041E42"
        },
        
        {
            "team": "NJD",
            "color1": "#CE1126",
            "color2": "#000000"
        },
        {
            "team": "NYI",
            "color1": "#00539B",
            "color2": "#F47D30"
        },
        
        {
            "team": "NYR",
            "color1": "#0038A8",
            "color2": "#CE1126"
        },
        {
            "team": "OTT",
            "color1": "#000000",
            "color2": "#DA1A32"
        },
        
        {
            "team": "PHI",
            "color1": "#F74902",
            "color2": "#000000"
        },
        {
            "team": "PIT",
            "color1": "#000000",
            "color2": "#FCB514"
        },
        
        {
            "team": "SJS",
            "color1": "#006D75",
            "color2": "#000000"
        },
        {
            "team": "SEA",
            "color1": "#001425",
            "color2": "#96D8D8"
        },
        
        {
            "team": "STL",
            "color1": "#002F87",
            "color2": "#FCB514"
        },
        {
            "team": "TBL",
            "color1": "#002868",
            "color2": "#FFFFFF"
        },
        
        {
            "team": "TOR",
            "color1": "#00205B",
            "color2": "#FFFFFF"
        },
        {
            "team": "VAN",
            "color1": "#003D7D",
            "color2": "#007B49"
        },
        
        {
            "team": "VGK",
            "color1": "#B4975A",
            "color2": "#333F42"
        },
        {
            "team": "WSH",
            "color1": "#CF0A2C",
            "color2": "#041E41"
        },
        
        {
            "team": "WPG",
            "color1": "#041E41",
            "color2": "#004C97"
        },
        {
            "team": "ANA 2",
            "color1": "#F95602",
            "color2": "#111111"
        },
        
        {
            "team": "ARI 2",
            "color1": "#8c2633",
            "color2": "#111111"
        },
        {
            "team": "BOS 2",
            "color1": "#111111",
            "color2": "#FCB514"
        },
        
        {
            "team": "BUF 2",
            "color1": "#003087",
            "color2": "FFB81C"
        },

        {
            "team": "CAR 2",
            "color1": "#111111",
            "color2": "#d01026"
        },
        
        {
            "team": "CAR 3",
            "color1": "#c6c6ce",
            "color2": "#027b20"
        },
        {
            "team": "CBJ 2",
            "color1": "#011e42",
            "color2": "#decca3"
        },
        
        {
            "team": "CGY 2",
            "color1": "#000000",
            "color2": "#d30217"
        },
        {
            "team": "CHI 2",
            "color1": "#010101",
            "color2": "#FFFFFF"
        },
        
        {
            "team": "COL 2",
            "color1": "#002147",
            "color2": "#6F253C"
        },
        {
            "team": "DAL 2",
            "color1": "#000000",
            "color2": "#3dd91b"
        },
        
        {
            "team": "STL 2",
            "color1": "#184fb5",
            "color2": "#f7c705"
        },
        {
            "team": "STL 3",
            "color1": "#fcb513",
            "color2": "#1d51a0"
        },
        
        {
            "team": "STL 4",
            "color1": "#012c8a",
            "color2": "#fec701"
        },
        {
            "team": "MTL 2",
            "color1": "#3abded",
            "color2": "#192168"
        },
        
        {
            "team": "MIN 2",
            "color1": "#009236",
            "color2": "#fccf06"
        }



    ], 

    "games": [

        {
            "date": "10-12-2023",
            "time": "7:00 PM",
            "STLlogo": 1,
            "opponent": "DAL",
            "home": false,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "10-14-2023",
            "time": "7:00 PM",
            "STLlogo": 2,
            "opponent": "SEA",
            "home": true,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "10-19-2023",
            "time": "7:00 PM",
            "STLlogo": 1,
            "opponent": "ARI",
            "home": true,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "10-21-2023",
            "time": "7:00 PM",
            "STLlogo": 2,
            "opponent": "PIT",
            "home": false,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "10-24-2023",
            "time": "7:45 PM",
            "STLlogo": 1,
            "opponent": "WPG",
            "home": false,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "10-26-2023",
            "time": "8:00 PM",
            "STLlogo": 1,
            "opponent": "CGY",
            "home": false,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "10-27-2023",
            "time": "9:00 PM",
            "STLlogo": 1,
            "opponent": "VAN",
            "home": false,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "11-1-2023",
            "time": "8:30 PM",
            "STLlogo": 1,
            "opponent": "COL",
            "home": false,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "11-3-2023",
            "time": "7:00 PM",
            "STLlogo": 1,
            "opponent": "NJD",
            "home": true,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         
        {
            "date": "11-4-2023",
            "time": "6:00 PM",
            "STLlogo": 2,
            "opponent": "MTL",
            "home": true,
            "final": false,
            "STLscore": "-",
            "oppScore": "-",
            "overtime": false,
            "shootout": false,
            "STLshots": 0,
            "oppShots": 0,
        },
         

    ], 

}



let teams = [
    "ANA",
    "ANA 2",
    "ARI",
    "ARI 2",
    "ARI 3",
    "BOS",
    "BOS 2",
    "BUF",
    "BUF 2",
    "CAR",
    "CAR 2",
    "CAR 3",
    "CBJ",
    "CBJ 2",
    "CGY",
    "CGY 2",
    "CGY 3",
    "COL",
    "COL 2",
    "COL 3",
    "CHI",
    "CHI 2",
    "CHI 3",
    "DAL",
    "DAL 2",
    "DAL 3",
    "DET",
    "EDM",
    "EDM 2",
    "FLA",
    "LAK",
    "LAK 2",
    "MIN",
    "MIN 2",
    "MTL",
    "MTL 2",
    "NJD",
    "NJD 2",
    "NSH",
    "NYI",
    "NYR",
    "OTT",
    "PHI",
    "PIT",
    "SJS",
    "SEA",
    "STL",
    "STL 2",
    "STL 3",
    "STL 4",
    "TBL",
    "TBL 2",
    "TOR",
    "VAN",
    "VAN 2",
    "VGK",
    "WSH",
    "WPG",
    "WPG 2",
]

let colors = [
    "red", "blue", "brown", "green", "purple", "orange", "black", "gray", "gold", "teal", "#EE2325"
]

//

let liveText = "\u25cf LIVE"

const date = new Date()
// console.log(date)


// console.log(date)
let curDate = String(date.getMonth()+1)+"-"+String(date.getDate())+"-"+String(date.getFullYear())
// console.log(curDate)
let curHour = date.getHours()
let curMin = date.getMinutes()

let curTime = [curHour, curMin]

// console.log(String(curHour)+":"+String(curMin)+endTimeText)

function getTimeList(timeText) {
    let split = timeText.split(":")
    // console.log(split)
    let hour = Number(split[0])
    let ending = split[1].split(" ")
    // console.log(ending)
    let min = Number(ending[0])
    let end = ending[1]
    if (end == "AM") {} else {
        hour += 12
    }
    if ((end == "AM") && (hour == 12)) {
        hour = 0
    }
    // console.log(String(hour)+":"+String(min))
    return [hour,min]
}

function getNextGame() {
    for (let num = 0; num < allData.games.length; num++) {
        let gameDate = allData.games[num].date 
        let dateAtt = gameDate.split("-")
        let curDateAtt = curDate.split("-")
        // console.log(curDate)
        // console.log(gameDate)
        if (Number(dateAtt[2]) < Number(curDateAtt[2])) { 
            // console.log("Y") 
        }
        else if ((Number(dateAtt[2]) == Number(curDateAtt[2])) && (Number(dateAtt[0]) < Number(curDateAtt[0]))) { 
            // console.log("M") 
        }
        else if ((Number(dateAtt[2]) == Number(curDateAtt[2])) && (Number(dateAtt[0]) == Number(curDateAtt[0])) && (Number(dateAtt[1]) < Number(curDateAtt[1]))) { 
            // console.log("D") 
        }
        else if ((Number(dateAtt[2]) == Number(curDateAtt[2])) && (Number(dateAtt[0]) == Number(curDateAtt[0])) && (Number(dateAtt[1]) == Number(curDateAtt[1]))) { 
            let gameTime = getTimeList(allData.games[num].time)
            let curMinute = (curTime[0] * 60) + curTime[1]
            let gameMinute = (gameTime[0] * 60) + gameTime[1]
            
            if ((!allData.games[num].final) && ((curMinute >= gameMinute))) {
                // console.log(gameMinute)
                // console.log(curMinute)
                gameIsLive("nextTextNHL")
                return allData.games[num]
            }
            else if (curMinute < gameMinute) {
                return allData.games[num]
            }

        }
        else {
            // console.log(allData.games[num])
            return allData.games[num]
        }
    }
    return "void"
}

let liveScoreNHL = false

function gameIsLive(elemID) {
    // console.log(liveText)
    document.getElementById(elemID).textContent = liveText
    document.getElementById(elemID).style.color = "red"
    liveScoreNHL = true
}

function activateLiveScore(gameData) {
    try {
        document.getElementById("liveStlScoreNHL").style.display = "block"
        document.getElementById("liveOppScoreNHL").style.display = "block"
        document.getElementById("liveStlScoreNHL").textContent = gameData.STLscore
        document.getElementById("liveOppScoreNHL").textContent = gameData.oppScore
        
    } catch (error) {
        
    }
}

function getLastGame() {
    for (let num = allData.games.length-1; num >= 0; num--) {
        let gameDate = allData.games[num].date 
        let dateAtt = gameDate.split("-")
        let curDateAtt = curDate.split("-")
        // console.log(allData.games[num])
        // console.log(curDate)
        // console.log(gameDate)
        if (Number(dateAtt[2]) > Number(curDateAtt[2])) { 
            // console.log("Y")
        }
        else if ((Number(dateAtt[2]) == Number(curDateAtt[2])) && (Number(dateAtt[0]) > Number(curDateAtt[0]))) { 
            // console.log("M")
        }
        else if ((Number(dateAtt[2]) == Number(curDateAtt[2])) && (Number(dateAtt[0]) == Number(curDateAtt[0])) && (Number(dateAtt[1]) > Number(curDateAtt[1]))) { 
            // console.log("D")
        }
        else if ((Number(dateAtt[2]) == Number(curDateAtt[2])) && (Number(dateAtt[0]) == Number(curDateAtt[0])) && (Number(dateAtt[1]) == Number(curDateAtt[1]))) { 
            let gameTime = getTimeList(allData.games[num].time)
            let curMinute = (curTime[0] * 60) + curTime[1]
            let gameMinute = (gameTime[0] * 60) + gameTime[1]
            
            // console.log("FJAKL;FADS;LFDASKL;FJDAS")
            if ((curMinute > gameMinute) && (allData.games[num].final)) {
                return allData.games[num]
            }
        }
        else {
            // console.log(allData.games[num])
            return allData.games[num]
        }
    }
    return "void"
}

// console.log(getNextGame())
// console.log(getLastGame())


function readTextFile(file, callback) {
    var rawFile = new XMLHttpRequest();
    rawFile.overrideMimeType("application/json");
    rawFile.open("GET", file, true);
    rawFile.onreadystatechange = function() {
        if (rawFile.readyState === 4 && rawFile.status == "200") {
            callback(rawFile.responseText);
        }
    }
    rawFile.send(null);
}

// const express = require('express');
// const request = require('request');

// const app = express();

// app.use((req, res, next) => {
//   res.header('Access-Control-Allow-Origin', '*');
//   next();
// });

// app.get('/jokes/random', (req, res) => {
//   request(
//     { url: 'schedule.json' },
//     (error, response, body) => {
//       if (error || response.statusCode !== 200) {
//         return res.status(500).json({ type: 'error', message: err.message });
//       }

//       res.json(JSON.parse(body));
//     }
//   )
// });

// const PORT = process.env.PORT || 3000;
// app.listen(PORT, () => console.log(`listening on ${PORT}`));

// //usage:
// readTextFile("schedule.json", function(text){
//     var data = JSON.parse(text);
//     console.log(data);
// });



function getRandomNumber() {
    let number = Math.floor(Math.random() * 11);
    // console.log(number)
    return String(number)
}

function getRandomTeam() {
    let teamNum = Math.floor(Math.random() * teams.length)
    var teamText = teams[teamNum]
    // console.log(teamText)
    while (getTrueTeamText(teamText) == "STL") {
        let newData = getRandomTeam()
        teamText = newData[0]
        teamNum = newData[1]
    }
    return [teamText,teamNum]
}

function getRandomSTL() {
    let teamNum = Math.floor(Math.random() * 4) + teams.indexOf("STL")
    var teamText = teams[teamNum]
    // console.log(teamText)
    while (getTrueTeamText(teamText) != "STL") {
        let newData = getRandomTeam()
        teamText = newData[0]
        teamNum = newData[1]
    }
    return [teamText,teamNum]
}

function getTrueTeamText(team) {
    let newString = team.substring(0,3)
    return newString
}

function teamLogo(team, sport) {
    if (!teams.includes(team)) {
        team = sport
    }
    let fileText = sport + " SVGs/"+team+".svg"
    return fileText
}

// let table = document.getElementById("csv-data");
// let url = 'https://www.nhl.com/gamecenter/stl-vs-dal/2023/10/12/2023020013'
// let url2 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRQ4WH7Z1nbwcCSPnX5rRGx_CVVwUqKkQrxIk9QYyXrLntAnQ3q2qIYu3Lnu6KVYpj9jeKN4ikZsARD/pub?gid=0&single=true&output=csv'

// fetch(url2)
//     .then(res => res.blob())
//     .then(blob => blob.stream())
//     .then(stream => stream.getReader())
//     .then(reader => reader.read())
    // .then(read => console.log(read.value))





// fetch(url)
//     .then(response => response.text())
//     .then(data => {
//         let rows = data.split("\n");
//         for (let i = 0; i < rows.length; i++) {
//             let cells = rows[i].split(",");
//             let row = table.insertRow();
//             for (let j = 0; j < cells.length; j++) {
//                 let cell = row.insertCell();
//                 cell.innerText = cells[j];
//             }
//         }
//     })
//     .catch(error => console.log(error));

// let charsReceived = 0
var list2 = ""
var result = ""

// fetch(url)
//     .then(res => res.blob())
//     .then(blob => blob.stream())
//     .then(stream => stream.getReader())
//     .then(reader => reader.read().then(function processText( { done, value } ) {
//         console.log("here")
//         // Result objects contain two properties:
//         // done  - true if the stream has already given you all its data.
//         // value - some data. Always undefined when done is true.
//         if (done) {
//             console.log("Stream complete");
//             document.getElementById("result-text").textContent = value;
//             return;
//         }
        
//         // value for fetch streams is a Uint8Array
//         charsReceived += value.length;
//         console.log(String(charsReceived));
//         const chunk = value;
//         console.log(chunk);
//         let listItem = document.createElement("li");
//         listItem.textContent = `Received ${charsReceived} characters so far. Current chunk = ${chunk}`;
//         list2 += listItem
//         list2 += ", "

//         result += chunk;

//         // Read some more, and call this function again
//         return reader.read().then(processText);
//     }));

let docURLlist = document.URL.split("/")

if (docURLlist[docURLlist.length-1] == "scorebox.html") {

// let info = getRandomTeam()
// let opponent = info[0]
// // let tNum = info[1]

// let STLinfo = getRandomSTL()
// let STLteam = STLinfo[0]
// // let STLtNum = STLinfo[1]

function getColorIndex(text) {
    let colorIndex = 0
    for (let num = 0; num < allData.colors.length; num++) {
        var currOpp = allData.colors[num].team
        if (text == currOpp) {
            // console.log(currOpp)
            colorIndex = num
            break
        }
    }
    return colorIndex
}

let lastGameInfoNHL = getLastGame()
let lastOppNHL = lastGameInfoNHL.opponent
// console.log(lastGameInfo)

var endText = ""
let ot = lastGameInfoNHL.overtime
let shootout = lastGameInfoNHL.shootout
if (ot) {
    endText = "/OT"
} else if (shootout) {
    endText = "/SO"
}
// console.log(endText)


if (lastGameInfoNHL == "void") {
    document.getElementById("lastGameNHL").style.visibility = "hidden"
    document.getElementById("lastGameNHL").style.display = "none"
    // document.getElementById("barrier").style.display = "none"
} else {
    let lastSTLteamNHL = "STL"
    if (lastGameInfoNHL.STLlogo != 1) {
        lastSTLteamNHL += (" " + String(lastGameInfoNHL.STLlogo))
    }
    // console.log(STLteam)

    document.getElementById("lastStlTextNHL").textContent = getTrueTeamText(lastSTLteamNHL)
    document.getElementById("lastOppTextNHL").textContent = getTrueTeamText(lastOppNHL)

    document.getElementById("lastStlLogoNHL").src = teamLogo(lastSTLteamNHL, "NHL")
    document.getElementById("lastOppLogoNHL").src = teamLogo(lastOppNHL, "NHL")

    document.getElementById("lastStlScoreNHL").textContent = lastGameInfoNHL.STLscore
    document.getElementById("lastOppScoreNHL").textContent = lastGameInfoNHL.oppScore
    
    // document.getElementById("lastStlScore").style.color = allData.colors[getColorIndex(lastSTLteam)].color2
    // document.getElementById("lastOppScore").style.color = allData.colors[getColorIndex(lastOpp)].color2

    document.getElementById("lastTextNHL").textContent = "LAST | " + lastGameInfoNHL.date + " | FINAL" + endText

    // console.log(allData.colors.length)
    document.getElementById("lastStlBoxNHL").style.backgroundColor = allData.colors[getColorIndex(lastSTLteamNHL)].color1
    document.getElementById("lastOppBoxNHL").style.backgroundColor = allData.colors[getColorIndex(lastOppNHL)].color1

}

// let stlIndex = teams.indexOf("STL")



// NEXT GAME

let nextGameInfoNHL = getNextGame()
let nextOpp = nextGameInfoNHL.opponent

if (liveScoreNHL) {
    activateLiveScore(nextGameInfoNHL)
}

if (nextGameInfoNHL == "void") {
    document.getElementById("nextGameNHL").style.visibility = "hidden"
    document.getElementById("nextGameNHL").style.display = "none"
//     document.getElementById("barrier").style.display = "none"
}

let nextSTLteam = "STL"
if (nextGameInfoNHL.STLlogo != 1) {
    nextSTLteam += (" " + String(nextGameInfoNHL.STLlogo))
}

document.getElementById("nextStlTextNHL").textContent = getTrueTeamText(nextSTLteam)
document.getElementById("nextOppTextNHL").textContent = getTrueTeamText(nextOpp)

document.getElementById("nextStlLogoNHL").src = teamLogo(nextSTLteam, "NHL")
document.getElementById("nextOppLogoNHL").src = teamLogo(nextOpp, "NHL")

// document.getElementById("nextStlScore").textContent = nextGameInfo.STLscore
// document.getElementById("nextOppScore").textContent = nextGameInfo.oppScore

document.getElementById("nextStlBoxNHL").style.backgroundColor = allData.colors[getColorIndex(nextSTLteam)].color1
document.getElementById("nextOppBoxNHL").style.backgroundColor = allData.colors[getColorIndex(nextOpp)].color1

// document.getElementById("nextStlScore").style.color = allData.colors[getColorIndex(nextSTLteam)].color2
// document.getElementById("nextOppScore").style.color = allData.colors[getColorIndex(nextOpp)].color2

if (document.getElementById("nextTextNHL").textContent == liveText) {}
else {
    document.getElementById("nextTextNHL").textContent = "NEXT | " + nextGameInfoNHL.date + " | " + nextGameInfoNHL.time
}



}